## Memo
<!-- - RTX 5090 setup
  - torch2.8.0
  - cuda 118
  - wsl (cu128)
```bash
pip install --pre torch torchvision torchaudio --index-url https://download.pytorch.org/whl/nightly/cu128
source activate base
conda activate needle_seg
``` -->

### Environment
- WSL
  - Setup WSL & CUDA & Conda environment
    1. Follow https://blog.csdn.net/LoongEmbedded/article/details/127842365 and https://docs.nvidia.com/cuda/wsl-user-guide/index.html to install WSL, CUDA Toolkit, and Anaconda. CUDA Toolkit Download: `Linux` `WSL-Ubuntu` `2.0` `x86_64`, installer type: `deb(local)`
    2. install torch (instruction from NVIDIA https://github.com/lllyasviel/Fooocus/issues/3862#issuecomment-2637819598)
        ```bash
        pip install --pre torch torchvision torchaudio --index-url https://download.pytorch.org/whl/nightly/cu128
        ```
    3. make sure the needed files in Dropbox are locally accessible
    4. clone git repo under `/home/sonav` (program under `/home/` seemed faster than in `/mnet/c/Users`)
    5. build environment
        ```bash
        cd needle_seg_det
        conda env create -f environment_linux.yml
        ```
    6. Speedup extension in TransNeXt (Optional)

        Follow https://github.com/DaiShiResearch/TransNeXt?tab=readme-ov-file#cuda-implementation,
        download and move swattention_extension folder to `./model/mask2former`
          ```bash
          cd ./model/mask2former/swattention_extension
          pip install .
          ```
        NOTE: This should be done under `conda activate needle_seg` 
        If "error: Microsoft Visual C++ 14.0 or greater is required", download Microsoft C++ Build Tools.

  - WSL Settings 
    - distribution: Ubuntu
    - version: 2
    - **password: 963963**
  - GPU related Settings
    - cuda 12.8 (12.9 might be unstable)
    - pytorch 2.8.0
  - Conda Settings
    - python 3.12
  - Implement
    ```bash
    wsl  ## enter 
    cd /home/sonav/needle_seg_det 
    source activate base ## optional
    conda activate needle_seg
    exit ## leave
    ```
temporally close all swattention
error now: 
swattention  (fixing with installing update package)
build memm2f and inference slow

mvcc on local
want to read data without dataloader but still work fast


### Model Settings (End User no need to look into this)
  * Segmentation model
      - `transnext_mask2former_cls_T512384_pixup_foc20aux1_v6imgLCR_k2`:

          - `config.json`
              - "image_size" : 384
              - "structure" : "mask2former"
          - `m2f_config.json`
              - "encoder_type" : "TransNeXt-Tiny"
              - "decoder_type": "pixelup"


      - `convnext_mask2former_cls_rB384_pixup_foc20aux1_v6imgLCR_k2`:
          - `config.json`
              - "image_size" : 384
              - "structure" : "mask2former"
          - `m2f_config.json`
              - "encoder_type" : "ConvNext"
              - "decoder_type": "pixelup"

  * Track model
      - `memm2f_cls_rB384_pixu_RNA_C2sam2_BLLF20MA2_tciou78_2BqattGP_v6imgLCR_k2_update`:
          - `config.json`
              - "image_size" : 384
              - "structure" : "mem_m2f"
          - `mem_m2f_config.json`
              - "encoder_type" : "ConvNext"
              - "decoder_type": "pixel"
              - "vis_query_att":true
              - "branch":2
              - "short_term_t":1
              - "qatt_block":"gp"